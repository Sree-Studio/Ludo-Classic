<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ludo Game</title>

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #1e1e2f;
    color: white;
    text-align: center;
}

#menu, #game {
    padding: 20px;
}

.hidden { display: none; }

button {
    padding: 12px 20px;
    margin: 10px;
    font-size: 16px;
    cursor: pointer;
    background: #444;
    color: white;
    border: none;
    border-radius: 5px;
}

button:hover { background: #666; }

#dice {
    width: 80px;
    height: 80px;
    background: white;
    color: black;
    font-size: 40px;
    line-height: 80px;
    margin: 20px auto;
    border-radius: 10px;
}

#board {
    display: grid;
    grid-template-columns: repeat(13, 40px);
    grid-template-rows: repeat(13, 40px);
    gap: 2px;
    background: #222;
    padding: 5px;
    justify-content: center;
    margin: auto;
}

.cell {
    width: 40px;
    height: 40px;
    background: #eee;
    border-radius: 4px;
    position: relative;
}

.safe {
    background: #cfd8dc;
    border: 2px solid gold;
}

.token {
    width: 25px;
    height: 25px;
    border-radius: 50%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    cursor: pointer;
    border: 2px solid black;
}

.red { background: red; }
.green { background: green; }
.blue { background: blue; }
.yellow { background: gold; }

#winScreen {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.9);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
</style>
</head>

<body>

<div>
<label>
<input type="checkbox" id="soundToggle" checked> Sound
</label>
<button onclick="toggleFullscreen()">Fullscreen</button>
<button onclick="location.reload()">Restart</button>
</div>

<h1>üé≤ LUDO GAME üé≤</h1>

<div id="menu">
<button onclick="startGame(1)">Single Player</button>
<button onclick="startGame(2)">2 Player</button>
<button onclick="startGame(4)">4 Player</button>
</div>

<div id="game" class="hidden">
<h2 id="turnText"></h2>
<div id="dice">üé≤</div>
<button onclick="rollDice()">Roll Dice</button>
<div id="board"></div>
</div>

<div id="winScreen" class="hidden">
<h1>üèÜ Game Over</h1>
<ol id="finalLeaderboard"></ol>
<button onclick="location.reload()">Play Again</button>
</div>

<script>
/* ===== SETTINGS ===== */
let soundOn = true;

document.getElementById("soundToggle").onchange = e => {
    soundOn = e.target.checked;
};

/* ===== GAME DATA ===== */
const COLORS = ["red","green","blue","yellow"];

/* Correct circular path (40 tiles) */
const BOARD_PATH = [
  44,45,46,47,48,
  61,74,87,100,113,126,
  127,128,129,116,103,90,77,64,
  63,62,61,60,59,58,
  45,32,19,6,5,4,3,16,29,42
];

const SAFE_INDEXES = [0, 8, 13, 21, 26, 34];

let players = [];
let currentPlayer = 0;
let diceValue = 0;
let leaderboard = [];

/* ===== START GAME ===== */
function startGame(count) {
    document.getElementById("menu").classList.add("hidden");
    document.getElementById("game").classList.remove("hidden");

    players = [];
    leaderboard = [];
    currentPlayer = 0;

    for (let i = 0; i < count; i++) {
        players.push({
            color: COLORS[i],
            pieces: [-1,-1,-1,-1],
            finished: 0,
            ai: count === 1 && i !== 0
        });
    }

    drawBoard();
    updateTurn();
}

/* ===== BOARD ===== */
function drawBoard() {
    const board = document.getElementById("board");
    board.innerHTML = "";

    for (let i = 0; i < 169; i++) {
        const cell = document.createElement("div");
        cell.className = "cell";
        board.appendChild(cell);
    }

    SAFE_INDEXES.forEach(i => {
        document.querySelectorAll(".cell")[BOARD_PATH[i]].classList.add("safe");
    });

    drawTokens();
}

function drawTokens() {
    const cells = document.querySelectorAll(".cell");

    players.forEach((p, pi) => {
        p.pieces.forEach((pos, ti) => {
            if (pos < 0) return;

            const token = document.createElement("div");
            token.className = `token ${p.color}`;
            token.onclick = () => movePiece(pi, ti);
            cells[BOARD_PATH[pos]].appendChild(token);
        });
    });
}

/* ===== GAME LOGIC ===== */
function rollDice() {
    if (diceValue !== 0) return;

    diceValue = Math.floor(Math.random() * 6) + 1;
    document.getElementById("dice").innerText = diceValue;

    if (players[currentPlayer].ai) {
        setTimeout(aiMove, 600);
    }
}

function movePiece(pi, ti) {
    if (pi !== currentPlayer || diceValue === 0) return;

    let pos = players[pi].pieces[ti];

    if (pos === -1 && diceValue !== 6) return;
    if (pos === -1) pos = 0;
    else pos += diceValue;

    if (pos >= BOARD_PATH.length) {
        players[pi].finished++;
        players[pi].pieces[ti] = -2;
        checkWin(pi);
    } else {
        players[pi].pieces[ti] = pos;
        capture(pi, pos);
    }

    diceValue = 0;
    drawBoard();

    if (!players[pi].ai && diceValue !== 6) nextTurn();
}

function capture(pi, pos) {
    if (SAFE_INDEXES.includes(pos)) return;

    players.forEach((p, i) => {
        if (i === pi) return;
        p.pieces.forEach((pp, j) => {
            if (pp === pos) p.pieces[j] = -1;
        });
    });
}

function nextTurn() {
    do {
        currentPlayer = (currentPlayer + 1) % players.length;
    } while (players[currentPlayer].finished === 4);

    updateTurn();

    if (players[currentPlayer].ai) rollDice();
}

function updateTurn() {
    document.getElementById("turnText").innerText =
        "Turn: " + players[currentPlayer].color.toUpperCase();
}

function aiMove() {
    const p = players[currentPlayer];
    const moves = [];

    p.pieces.forEach((pos, i) => {
        if (pos === -1 && diceValue === 6) moves.push(i);
        else if (pos >= 0) moves.push(i);
    });

    if (moves.length) {
        movePiece(currentPlayer, moves[Math.floor(Math.random()*moves.length)]);
    }
}

function checkWin(pi) {
    if (players[pi].finished === 4) {
        leaderboard.push(players[pi].color);
        if (leaderboard.length === players.length) showWin();
    }
}

function showWin() {
    document.getElementById("winScreen").classList.remove("hidden");
    const list = document.getElementById("finalLeaderboard");
    leaderboard.forEach(c => {
        const li = document.createElement("li");
        li.innerText = c.toUpperCase();
        list.appendChild(li);
    });
}

function toggleFullscreen() {
    if (!document.fullscreenElement)
        document.documentElement.requestFullscreen();
    else
        document.exitFullscreen();
}
</script>
</body>
</html>
